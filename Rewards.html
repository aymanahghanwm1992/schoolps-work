<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200, initial-scale=1.0">
    <title>âœ… Ø¬Ø¯Ø§Ø± Ø´Ø±Ù Ø§Ù„Ù…ÙƒØ±Ù…ÙŠÙ† Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ Ø§Ù„Ø±Ø§Ù‚ÙŠ âœ…</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&family=Changa:wght@600;800&display=swap" rel="stylesheet">
    <style>
        /* [Ø£Ù†Ù…Ø§Ø· CSS] */
        :root {
            /* ================================================= */
            /* ğŸ¨ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØºÙŠÙŠØ± ğŸ¨ */
            /* ================================================= */
            --color-card-primary: #10B981; /* Ø£Ø®Ø¶Ø± Ø²Ù…Ø±Ø¯ÙŠ Ø¥ÙŠØ¬Ø§Ø¨ÙŠ */
            --color-card-secondary: #34D399; /* Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ Ù„Ù„ØªØ¯Ø±Ø¬ */
            --color-highlight-text: #1F2937; /* Ù„ÙˆÙ† Ù†Øµ Ø¯Ø§ÙƒÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙØ§ØªØ­Ø© */
            
            /* ================================================= */
            /* âš™ï¸ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ø© (Ù„Ø§ ÙŠÙÙ†ØµØ­ Ø¨ØªØºÙŠÙŠØ±Ù‡Ø§) âš™ï¸ */
            /* ================================================= */
            --color-primary-text: var(--color-highlight-text); 
            --color-secondary-text: #4B5563; 
            --color-glass-bg: rgba(255, 255, 255, 0.9);
            --color-glass-border: rgba(255, 255, 255, 0.7); 
            --font-header: 'Changa', sans-serif;
            --font-body: 'Cairo', sans-serif;
            --card-width: 90vw;
            --card-height: 60vh;
            --max-card-width: 950px; 
            --max-card-height: 550px; 

            /* ğŸŒŸ Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù‚ØµØ§ØµØ§Øª Ø§Ù„Ø´ÙØ§ÙØ© (CSS Confetti) ğŸŒŸ */
            --confetti-color-1: rgba(255, 240, 150, 0.5); /* Ø°Ù‡Ø¨ÙŠ ÙØ§ØªØ­ ÙˆØ´ÙØ§Ù 50% */
            --confetti-color-2: rgba(150, 230, 255, 0.4); /* Ø³Ù…Ø§ÙˆÙŠ ÙØ§ØªØ­ ÙˆØ´ÙØ§Ù 40% */
            --confetti-color-3: rgba(180, 255, 180, 0.6); /* Ø£Ø®Ø¶Ø± ÙØ§ØªØ­ ÙˆØ´ÙØ§Ù 60% */
            --confetti-color-4: rgba(255, 255, 255, 0.3); /* Ø£Ø¨ÙŠØ¶ Ø®ÙÙŠÙ 30% */
        }

        /* Ø¥Ø¬Ø¨Ø§Ø± Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„Ù‡Ø§ØªÙ Ø¹Ø¨Ø± JS Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù‡Ø§ØªÙ Ø­ØªÙ‰ Ù„Ùˆ Ù„Ù… ØªØ¹Ù…Ù„ Ù…ÙŠØ¯ÙŠØ§ ÙƒÙˆÙŠØ±ÙŠ */
        .is-mobile .right-toolbar { display: none !important; }
        .is-mobile #mobileToolbar { display: flex !important; }
        /* Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨ ÙƒÙ€ Bottom Sheet Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
        .is-mobile .picker-panel { right: 0 !important; left: 0 !important; top: auto !important; bottom: 0 !important; width: 100vw !important; max-height: 60vh !important; transform: none !important; border-radius: 18px 18px 0 0 !important; z-index: 2500 !important; }
        .picker-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.28); display: none; z-index: 2400; }

        /* Ø´Ø±ÙŠØ· Ø£Ø¯ÙˆØ§Øª Ø®Ø§Øµ Ø¨Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø£Ø³ÙÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .mobile-toolbar {
            display: none;
            max-width: 1200px;
            margin: 16px auto 0;
            padding: 8px 10px;
            background: rgba(255,255,255,.88);
            border: 1px solid var(--color-glass-border);
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(0,0,0,.06);
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .mobile-toolbar .tool-btn { width: 40px; height: 40px; font-size: 18px; }
        .mobile-toolbar .tooltip { display: none; }
        /* Ø´Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© */
        .pos-badge {
            display: inline-block;
            margin-inline-start: 10px;
            padding: 4px 10px;
            border-radius: 999px;
            background: linear-gradient(45deg, var(--color-card-primary), var(--color-card-secondary));
            color: #fff;
            font-weight: 800;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        body {
            font-family: var(--font-body);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            overflow-x: hidden; 
            
            /* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© (Ø¯Ø±Ø¬Ø§Øª ÙØ§ØªØ­Ø© Ø¬Ø¯Ù‹Ø§) */
            background: linear-gradient(-45deg,
                #f7fff9,
                #fefefe,
                #f0fdf4,
                #ecfdf5
            );
            
            background-size: 800% 800%; 
            animation: gradient 18s ease infinite;
            color: var(--color-primary-text);
        }

       
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 20px;
        }

        /* Ø´Ø±ÙŠØ· Ø£Ø¯ÙˆØ§Øª Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙŠÙ…ÙŠÙ† Ø§Ù„ØµÙØ­Ø© */
        .right-toolbar {
            position: fixed;
            right: 12px;
            top: 30%;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }
        .tool-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: 2px solid var(--color-card-primary);
            background: #fff;
            color: var(--color-card-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            position: relative;
            transition: transform .15s ease, background .2s ease, color .2s ease;
        }
        .tool-btn:hover { transform: translateY(-2px); background: var(--color-card-secondary); color: #0f5132; }
        .tool-btn.active { background: var(--color-card-primary); color: #fff; }
        .tool-btn .tooltip {
            position: absolute;
            right: 52px;
            white-space: nowrap;
            background: rgba(255,255,255,.95);
            border: 1px solid var(--color-glass-border);
            box-shadow: 0 6px 16px rgba(0,0,0,.08);
            color: var(--color-primary-text);
            font-family: var(--font-header);
            font-size: 12px;
            font-weight: 800;
            padding: 6px 10px;
            border-radius: 10px;
            pointer-events: none;
            opacity: 0;
            transform: translateX(6px);
            transition: opacity .15s ease, transform .15s ease;
        }
        .tool-btn:hover .tooltip { opacity: 1; transform: translateX(0); }

        h1.title {
            font-family: var(--font-header);
            font-size: clamp(2.5em, 5vw, 4.8em);
            color: var(--color-primary-text); 
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.1); 
            margin-bottom: 5px; 
            position: relative;
        }
        
        .date-display {
            font-family: var(--font-header);
            font-size: clamp(1em, 2vw, 1.8em);
            color: var(--color-secondary-text);
            padding: 10px 20px;
            margin-bottom: 30px; 
            
            background: rgba(255, 255, 255, 0.6); 
            backdrop-filter: blur(10px); 
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.7);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); 
        }

        #honorRoll {
            width: var(--card-width); 
            max-width: var(--max-card-width);
            height: var(--card-height);
            max-height: var(--max-card-height);
            position: relative;
            overflow: hidden;
            border-radius: 28px;
            
            background: var(--color-glass-bg);
            backdrop-filter: blur(18px) saturate(180%);
            -webkit-backdrop-filter: blur(18px) saturate(180%);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1), 0 0 1px rgba(0,0,0,0.05); 
            border: 2px solid var(--color-glass-border); 
            
            animation: fadeIn 1s ease-out; 
            z-index: 10;
        }

        .left-progress {
            position: fixed;
            left: 10px;
            bottom: 20px;
            width: 10px;
            height: calc(100vh - 40px);
            border-radius: 8px;
            background: rgba(0,0,0,0.06);
            overflow: hidden;
            z-index: 999;
        }
        .left-progress .left-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(180deg, var(--color-card-secondary), var(--color-card-primary));
            transition: height .6s ease;
        }
        .left-progress .left-label {
            position: absolute;
            left: 16px;
            bottom: 10px;
            color: var(--color-secondary-text);
            font-family: var(--font-header);
            font-weight: 800;
            background: rgba(255,255,255,.7);
            border: 1px solid var(--color-glass-border);
            border-radius: 10px;
            padding: 4px 8px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(25px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .large-card {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-around;
            padding: 40px;
            box-sizing: border-box;
            background: transparent; 
            
            opacity: 0;
            z-index: 1;
            transform: scale(0.9) translateX(100%);
            transition: opacity 0.6s ease-in-out, transform 0.7s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .large-card.active {
            opacity: 1;
            z-index: 10;
            transform: scale(1) translateX(0);
        }

        .large-card.exit {
            opacity: 0;
            z-index: 5;
            transform: scale(1.1) translateX(-100%);
        }

        .card-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            text-align: center; 
            padding-right: 50px;
        }

        .photo-area {
            width: 280px;
            height: 280px;
            position: relative;
            flex-shrink: 0;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--color-card-primary), var(--color-card-secondary));
            padding: 8px;
            box-shadow: 0 0 20px var(--color-card-primary);
        }

        .student-photo {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--color-glass-bg); 
            animation: pulse 4s infinite ease-in-out;
        }
        
        .card-details p {
             color: var(--color-secondary-text);
        }

        .student-name {
            font-family: var(--font-header);
            font-size: clamp(2.4em, 5vw, 4.2em); 
            font-weight: 900;
            color: var(--color-primary-text); 
            text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
        }

        .reward-tag {
            display: block; 
            font-size: clamp(1.2em, 3.5vw, 3.5em); 
            font-weight: 800;
            background: linear-gradient(45deg, var(--color-card-primary) 0%, var(--color-card-secondary) 100%); 
            color: #FFFFFF;
            padding: 18px 45px; 
            border-radius: 60px; 
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2); 
            margin-top: 30px; 
            border: 4px solid var(--color-glass-border); 
            transform: rotate(-1deg); 
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-in-out; 
            text-align: center;
            max-width: 90%; 
            line-height: 1.2;
            text-shadow: none; 
        }
        .reward-tag:hover {
            transform: rotate(0deg) scale(1.05); 
        }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ */
        .message-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            background: rgba(255, 255, 255, 0.9); 
            border: 4px dashed var(--color-card-primary);
            border-radius: 15px;
            font-size: 1.6em;
            color: var(--color-primary-text);
            width: 80%;
            max-width: 500px;
            z-index: 20;
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ÙÙˆØ² Ø§Ù„Ù„Ø­Ø¸ÙŠ (Ù‚ØµØ§ØµØ§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©) */
        .confetti-effect {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            overflow: hidden;
            pointer-events: none;
            z-index: 15;
        }
        .confetti {
            position: absolute;
            width: 10px; 
            height: 20px;
            background-color: var(--color-card-primary); 
            opacity: 0;
            animation: confetti-fall 3s ease-in forwards;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 5px var(--color-card-primary); }
            50% { box-shadow: 0 0 25px var(--color-card-primary), 0 0 10px rgba(255, 255, 255, 0.5); }
            100% { box-shadow: 0 0 5px var(--color-card-primary); }
        }
        
        @keyframes confetti-fall {
            0% { opacity: 1; transform: translateY(-100px) rotate(0deg); }
            100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
        }
        
        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 900px) {
            #honorRoll {
                width: 95vw;
                height: 85vh; 
                max-height: 600px;
                padding: 15px;
            }
            .large-card {
                flex-direction: column;
                justify-content: flex-start; 
                padding: 20px 10px;
            }
            .card-details {
                padding-right: 0;
                margin-top: 15px;
            }
            .photo-area {
                width: 180px;
                height: 180px;
                margin-bottom: 5px;
            }
            .student-name {
                font-size: 1em;
            }
            .reward-tag {
                font-size: 1em; 
                padding: 10px 20px;
                transform: rotate(0deg); 
                border-radius: 50px;
            }
            .date-display {
                font-size: 1em;
                padding: 8px 15px;
            }
        }

        /* Ø£Ø¬Ù‡Ø²Ø© Ù„ÙˆØ­ÙŠØ© (<= 1024px) */
        @media (max-width: 1024px) {
            :root { --card-width: 94vw; --max-card-width: 1000px; }
            .right-toolbar { top: 24%; }
            .title { margin-bottom: 8px; }
            .date-display { margin-bottom: 18px; }
        }

        /* Ù‡ÙˆØ§ØªÙ ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ (<= 480px) */
        @media (max-width: 480px) {
            /* Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ÙŠØµØ¨Ø­ Ø´Ø±ÙŠØ· Ø³ÙÙ„ÙŠ Ø£ÙÙ‚ÙŠ */
            .right-toolbar { display: none; }
            #mobileToolbar { display: flex; }

            /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… ÙŠØ³Ø§Ø± Ø§Ù„Ø´Ø§Ø´Ø© ÙŠØªÙ‚Ø§Ø²Ù… ÙˆÙŠØ®ÙÙŠ Ø§Ù„Ø¹Ø¯Ø§Ø¯ */
            .left-progress { left: 6px; width: 6px; height: calc(100vh - 60px); }
            .left-progress .left-label { display: none; }

            /* Ù„ÙˆØ­Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø§Ù„Ø¨ ØªØµØ¨Ø­ ÙˆØ±Ù‚Ø© Ø³ÙÙ„ÙŠØ© */
            .picker-panel {
                right: 0; left: 0; top: auto; bottom: 0;
                width: 100vw; max-height: 60vh; transform: none; border-radius: 18px 18px 0 0;
            }
            .picker-header { padding: 12px; }
            .picker-header input { padding: 12px; }

            /* Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ® ØªØªØ£Ù‚Ù„Ù… */
            #rangeModal .modal-card { margin: 14vh auto; max-width: 92vw; border-radius: 16px; padding: 18px; }
            #rangeModal .modal-card > div[style*="grid-template-columns"] { grid-template-columns: 1fr; }

            /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø¹Ø±Ø¶ ØªØªØ£Ù‚Ù„Ù… */
            .cards-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }

            /* ØªÙƒØ¨ÙŠØ± Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ù†Ù‚Ø±Ø§Øª */
            .ctrl-btn { padding: 12px 14px; }

            /* Ù…Ù†Ø¹ ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø³ÙÙ„ÙŠ Ù…Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
            body { padding-bottom: calc(72px + env(safe-area-inset-bottom)); }
            
            /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø±ÙƒØ© Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ Ø§Ù„ØµØºÙŠØ±Ø© Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡ */
            .confetti-effect { display: none !important; }
            .large-card { padding: 14px 10px; }
            .card-details p { font-size: .95em; }
            .student-name { font-size: 1.2em; }
            .reward-tag { font-size: 1em; padding: 10px 16px; }
            .photo-area { width: 160px; height: 160px; }
            .message-box { width: 90%; font-size: 1.2em; padding: 18px; }

            /* Ù…Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª: Ù‡ÙŠØ¯Ø± Ù…Ø¯Ù…Ø¬ ÙˆØ¨Ø·Ø§Ù‚Ø§Øª Ø£ØµØºØ± */
            .all-cards-modal { padding: 8px 0 80px; }
            .all-cards-content { padding: 8px 12px 96px; }
            #printHeader { padding: 10px !important; border-radius: 12px !important; }
            #printHeader > div:first-child { font-size: 1.3em !important; }
            .mini-card { padding: 10px; border-radius: 14px; }
            .mini-card .mini-photo-area { width: 80px; height: 80px; margin-bottom: 6px; }
            .mini-card .mini-name { font-size: 1em; }
            .mini-meta { gap: 6px; margin: 4px 0; }
            .points-badge { padding: 3px 8px; font-size: .9em; }
            .mini-card .mini-actions { gap: 8px; margin-top: 8px; }
            .mini-icon { width: 32px; height: 32px; font-size: 14px; }

            /* Ø´Ø±ÙŠØ· Ø£Ø²Ø±Ø§Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ø¹Ø±Ø¶ Ø£ØµØºØ± */
            .modal-footer-bar { padding: 8px 10px; position: fixed; top: auto; bottom: calc(0px + env(safe-area-inset-bottom)); left: 0; right: 0; }
            .modal-footer-bar .ctrl-group { padding: 0 8px; gap: 8px; flex-wrap: wrap; justify-content: center; }
            .modal-footer-bar .ctrl-btn { padding: 8px 10px; font-size: .9em; }
        }

        /* Ø´Ø§Ø´Ø§Øª ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ */
        @media (max-width: 360px) {
            .cards-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 8px; }
            .mini-card { padding: 8px; border-radius: 12px; }
            .mini-card .mini-photo-area { width: 72px; height: 72px; }
            .mini-card .mini-name { font-size: .95em; }
            .mini-icon { width: 30px; height: 30px; font-size: 13px; }
            #printHeader > div:first-child { font-size: 1.2em !important; }
        }

        /* Ù‡ÙˆØ§ØªÙ Ù…ØªÙˆØ³Ø·Ø© (<= 768px) */
        @media (max-width: 768px) {
            :root { --card-height: 70vh; }
            .photo-area { width: 200px; height: 200px; }
            .student-name { font-size: 1.6em; }
            .reward-tag { font-size: 1.1em; padding: 12px 20px; }
            .cards-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 14px; }
        }
        
        /* --- ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¹Ø§Ù…Ø© Ù„Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ù†Ù…Ø§Ø°Ø¬ --- */
        .ctrl-btn {
            border: 2px solid var(--color-card-primary);
            background: #fff;
            color: var(--color-card-primary);
            font-family: var(--font-header);
            font-weight: 800;
            padding: 10px 14px;
            border-radius: 12px;
            cursor: pointer;
            transition: all .2s ease;
        }
        .ctrl-btn:hover { background: var(--color-card-secondary); color: #0f5132; }
        .ctrl-btn.primary { background: var(--color-card-primary); color: #fff; }
        .ctrl-btn.primary:hover { filter: brightness(0.95); }

        /* Ù†Ù…Ø· Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø®Ø§Øµ Ø¨Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ */
        .all-cards-modal {
            position: fixed;
            inset: 0;
            z-index: 1500;
            background: rgba(244, 244, 245, 0.95); /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© Ø´ÙØ§ÙØ© */
            backdrop-filter: blur(8px);
            overflow-y: auto;
            display: none; /* ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø±Ù‡ Ø¨Ø§Ù„Ù€ JS */
            padding: 20px 10px;
        }
        .all-cards-modal.show {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .all-cards-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 20px 110px; /* Ø­Ø¬Ø² Ù…Ø³Ø§Ø­Ø© Ø£Ø³ÙÙ„ Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø«Ø¨ØªØ© */
        }
        .all-cards-modal .all-cards-content { flex: 1; }
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 20px;
            margin-top: 25px;
            padding-bottom: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
        }
        /* 4 Ø£Ø¹Ù…Ø¯Ø© Ø¹Ù„Ù‰ Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨ */
        @media (min-width: 1200px) {
            .cards-grid { grid-template-columns: repeat(4, 1fr); }
        }
        .mini-card {
            background: var(--color-glass-bg);
            border: 1px solid var(--color-glass-border);
            border-radius: 16px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.15s ease;
            page-break-inside: avoid; /* Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù†Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
        }
        .mini-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        .mini-card .mini-actions { display:flex; justify-content:center; gap:10px; margin-top:12px; }
        .mini-icon {
            width: 36px; height: 36px; border-radius: 50%;
            border: 2px solid var(--color-card-primary);
            background:#fff; color: var(--color-card-primary);
            display:flex; align-items:center; justify-content:center;
            font-size: 16px; cursor: pointer; position: relative;
            transition: transform .15s ease, background .2s ease, color .2s ease;
        }
        .mini-icon:hover { transform: translateY(-2px); background: var(--color-card-secondary); color:#0f5132; }
        .mini-icon .tip {
            position: absolute; bottom: 44px; right: 50%; transform: translateX(50%);
            background: rgba(255,255,255,.98); color: var(--color-primary-text);
            border: 1px solid var(--color-glass-border); border-radius: 10px;
            padding: 4px 8px; font-size: 11px; font-weight: 800; font-family: var(--font-header);
            white-space: nowrap; box-shadow: 0 6px 16px rgba(0,0,0,.08);
            opacity: 0; pointer-events: none; transition: opacity .15s ease, transform .15s ease;
        }
        .mini-icon:hover .tip { opacity: 1; transform: translateX(50%) translateY(-2px); }
        .mini-card.highlight { outline: 3px solid #f59e0b; outline-offset: 2px; animation: pulse 1.2s ease-in-out 2; }
        .mini-card .mini-photo-area {
            width: 100px;
            height: 100px;
            margin: 0 auto 10px;
            border-radius: 50%;
            overflow: hidden;
            padding: 4px;
            background: linear-gradient(45deg, var(--color-card-primary), var(--color-card-secondary));
        }
        .mini-card .mini-photo-area img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid #fff;
        }
        .mini-card .mini-name {
            font-family: var(--font-header);
            font-size: 1.2em;
            font-weight: 900;
            color: var(--color-primary-text);
            margin-bottom: 5px;
        }
        .mini-meta { display:flex; align-items:center; justify-content:center; gap:10px; margin:6px 0 4px; color: var(--color-secondary-text); }
        .mini-meta .dot { width:8px; height:8px; border-radius:50%; background: var(--color-card-primary); box-shadow: 0 0 0 3px rgba(16,185,129,0.15); }
        .mini-meta .meta-text { font-weight: 800; }
        .points-badge { display:inline-block; background: linear-gradient(45deg, var(--color-card-primary), var(--color-card-secondary)); color:#fff; padding:4px 10px; border-radius:999px; font-weight:900; font-family: var(--font-header); box-shadow: 0 4px 10px rgba(0,0,0,.08); }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… (Ø·Ø¨Ø§Ø¹Ø© ÙˆÙ…Ø´Ø§Ø±ÙƒØ©) */
        .modal-footer-bar {
            position: fixed;
            bottom: calc(0px + env(safe-area-inset-bottom));
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--color-glass-border);
            padding: 10px 20px;
            text-align: center;
            z-index: 2000;
            box-shadow: 0 -4px 15px rgba(0,0,0,0.05);
        }
        .modal-footer-bar .ctrl-group {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 12px;
        }
        /* Ø§Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ù†Ù…Ø· Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .modal-footer-bar .tool-btn { width: 44px; height: 44px; border-radius: 50%; border: 2px solid var(--color-card-primary); background:#fff; color: var(--color-card-primary); display:inline-flex; align-items:center; justify-content:center; font-size:18px; box-shadow: 0 6px 18px rgba(0,0,0,.06); transition: transform .15s ease, background .2s ease, color .2s ease; }
        .modal-footer-bar .tool-btn:hover { transform: translateY(-2px); background: var(--color-card-secondary); color:#0f5132; }
        .modal-footer-bar .tool-btn .tooltip { position: absolute; right: 54px; top: 50%; transform: translateY(-50%) translateX(8px); background: rgba(255,255,255,.98); color: var(--color-primary-text); border:1px solid var(--color-glass-border); border-radius:10px; padding:6px 10px; font-size:12px; font-weight:800; font-family: var(--font-header); white-space:nowrap; box-shadow:0 6px 16px rgba(0,0,0,.08); opacity:0; pointer-events:none; transition: opacity .15s ease, transform .15s ease; }
        .modal-footer-bar .tool-btn:hover .tooltip { opacity:1; transform: translateY(-50%) translateX(0); }
        @media (max-width: 767.98px) {
            .modal-footer-bar .tool-btn .tooltip { bottom: 54px; left: 50%; right: auto; top: auto; transform: translate(-50%, 8px); }
            .modal-footer-bar .tool-btn:hover .tooltip { transform: translate(-50%, 0); }
        }
        .modal-footer-bar .ctrl-btn:hover::after { opacity: 1; }
        @media (max-width: 767.98px) { /* Ù‡Ø§ØªÙ: Ø§Ù„ØªÙ„Ù…ÙŠØ­ ÙÙˆÙ‚ Ø§Ù„Ø²Ø± */
            .modal-footer-bar .ctrl-btn::after { bottom: 58px; left: 50%; transform: translate(-50%, 4px); }
            .modal-footer-bar .ctrl-btn:hover::after { transform: translate(-50%, 0); }
        }
        @media (min-width: 768px) { /* Ù…ÙƒØªØ¨: Ø§Ù„ØªÙ„Ù…ÙŠØ­ ÙŠØ³Ø§Ø± Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù…ÙˆØ¯ÙŠ */
            .modal-footer-bar .ctrl-btn::after { right: 60px; top: 50%; transform: translate(4px, -50%); }
            .modal-footer-bar .ctrl-btn:hover::after { transform: translate(0, -50%); }
        }

        /* Ø´Ø±ÙŠØ· Ø¹Ù…ÙˆØ¯ÙŠ ÙŠÙ…ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø£ÙˆØ³Ø¹ (ÙŠØ¨Ù‚Ù‰ Ø³ÙÙ„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ) */
        @media (min-width: 768px) {
            .modal-footer-bar {
                top: 50%;
                bottom: auto;
                right: 16px;
                left: auto;
                transform: translateY(-50%);
                width: 64px;
                padding: 10px;
                border-top: none;
                border-left: 1px solid var(--color-glass-border);
                border-radius: 16px;
                box-shadow: 0 6px 24px rgba(0,0,0,0.08);
            }
            .modal-footer-bar .ctrl-group { flex-direction: column; justify-content: flex-start; gap: 10px; }
            .modal-footer-bar .tool-btn { width: 44px; height: 44px; font-size: 18px; }
            .all-cards-content { padding-right: 96px; padding-bottom: 20px; }
        }


        /* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© (Print Styles) */
        @media print {
            @page { size: A4; margin: 12mm; }
            body > *:not(.all-cards-modal) {
                display: none !important; /* Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø´ÙŠØ¡ Ù…Ø§ Ø¹Ø¯Ø§ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
            }
            body { font-family: 'Cairo', system-ui, sans-serif; }
            .all-cards-modal {
                position: static;
                display: block !important;
                background: none;
                box-shadow: none;
                overflow: visible;
                padding: 0;
            }
            .all-cards-content {
                max-width: none;
                padding: 0;
                margin: 0;
            }
            .modal-footer-bar { display: none !important; }
            .cards-grid {
                grid-template-columns: repeat(3, 1fr); /* 3 Ø£Ø¹Ù…Ø¯Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
                gap: 18px;
                padding: 0;
            }
            .mini-card {
                background: linear-gradient(135deg, var(--color-card-secondary), var(--color-card-primary));
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                color: #fff;
                border: 2px solid var(--color-card-primary);
                box-shadow: none;
                padding: 18px;
            }
            .mini-card .mini-name { color: #fff; font-family: 'Changa', sans-serif; font-size: 1.3em; letter-spacing: .2px; }
            .mini-meta .dot{ background:#fff; box-shadow: 0 0 0 3px rgba(255,255,255,.25) }
            .mini-card .mini-reward, .mini-meta .meta-text { color: #fff; font-family: 'Cairo', sans-serif; }
            .points-badge { background: linear-gradient(45deg, #059669, #10b981); color:#fff; box-shadow:none; font-family: 'Changa', sans-serif; letter-spacing:.2px; }
            /* Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø£Ø³ ÙÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¥Ù† ÙˆØ¬Ø¯ ÙƒØ£ÙˆÙ„ Ø¹Ù†ØµØ± Ø¯Ø§Ø®Ù„ #printHeader */
            #printHeader > div:first-child { font-family: 'Changa', sans-serif !important; letter-spacing: .3px; }
            .mini-card .mini-actions { display: none !important; }
        }
        
        /* Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ */
        .picker-panel {
            position: fixed;
            right: 64px;
            top: 30%;
            transform: translateY(-10px);
            background: #fff;
            border: 1px solid var(--color-glass-border);
            border-radius: 14px;
            box-shadow: 0 12px 30px rgba(0,0,0,.12);
            width: 260px;
            max-height: 60vh;
            display: none;
            z-index: 2600; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…Ù†ØªÙ‚ÙŠ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¸Ù‡ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ø³ÙˆØ¨ ÙˆØ§Ù„Ù‡Ø§ØªÙ */
            overflow: hidden;
        }
        .picker-header { display:flex; align-items:center; gap:8px; padding:10px; border-bottom:1px solid #eef2f7; }
        .picker-header input { flex: 1; padding:8px 10px; border:1px solid #e5e7eb; border-radius: 10px; font-family: var(--font-body); }
        .picker-list { list-style:none; margin:0; padding:6px; max-height: 48vh; overflow:auto; }
        .picker-list li { padding:8px 10px; border-radius: 10px; cursor:pointer; display:flex; align-items:center; justify-content: space-between; }
        .picker-list li:hover { background: var(--color-card-secondary); color:#0f5132; }
        /* Ø­Ø§Ù„Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ù†ØªÙ‚ÙŠ */
        .picker-panel.show { display: block !important; }
        .picker-empty { padding:12px; text-align:center; color: var(--color-secondary-text); }
        .pin-badge { font-size: 11px; background: var(--color-card-primary); color:#fff; border-radius:999px; padding:2px 8px; font-weight:900; font-family: var(--font-header); }
    </style>
</head>
<body>
    

    <div class="container">
        <h1 class="title">ğŸ† Ù„Ù€ÙˆØ­Ù€Ù€Ø© Ù…ÙƒØ§ÙØ¢Øª Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ ğŸ†</h1>
        
        <div id="currentDateTime" class="date-display"></div>

        <div class="right-toolbar">
            <button id="btnOldest" class="tool-btn" aria-label="Ø§Ù„Ø£Ù‚Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø­Ø¯Ø«">
                ğŸ•°ï¸
                <span class="tooltip">Ù…Ø±ØªÙ‘Ø¨: Ø§Ù„Ø£Ù‚Ø¯Ù… â†’ Ø§Ù„Ø£Ø­Ø¯Ø«</span>
            </button>
            <button id="btnTop" class="tool-btn" aria-label="Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª">
                ğŸ†
                <span class="tooltip">Ø­Ø³Ø¨ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø£Ø¹Ù„Ù‰</span>
            </button>
            <button id="btnRange" class="tool-btn" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ®">
                ğŸ“…
                <span class="tooltip">Ù…Ø¯Ù‰ ØªØ§Ø±ÙŠØ® (Ù…Ù† â†’ Ø¥Ù„Ù‰)</span>
            </button>
            <button id="btnRandom" class="tool-btn" aria-label="Ø¹Ø±Ø¶ Ø¹Ø´ÙˆØ§Ø¦ÙŠ">
                ğŸ”€
                <span class="tooltip">Ø¹Ø±Ø¶ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø§ÙØªØ±Ø§Ø¶ÙŠ)</span>
            </button>
            <button id="btnViewAll" class="tool-btn" aria-label="Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª">
                ğŸ“„
                <span class="tooltip">Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</span>
            </button>
            <button id="btnPickStudent" class="tool-btn" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨">
                ğŸ‘¤
                <span class="tooltip">Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨ Ù„Ø¹Ø±Ø¶Ù‡</span>
            </button>
        </div>

        <div id="honorRoll">
            <div class="message-box">
                Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø­Ø§ØµÙ„ÙŠÙ† Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ¢Øª...
            </div>
        </div>
        <!-- Ø´Ø±ÙŠØ· Ø£Ø¯ÙˆØ§Øª Ù„Ù„Ù‡ÙˆØ§ØªÙ Ø£Ø³ÙÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª -->
        <div id="mobileToolbar" class="mobile-toolbar" aria-label="Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù‡Ø§ØªÙ">
            <button id="mBtnOldest" class="tool-btn" aria-label="Ø§Ù„Ø£Ù‚Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø­Ø¯Ø«">ğŸ•°ï¸</button>
            <button id="mBtnTop" class="tool-btn" aria-label="Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª">ğŸ†</button>
            <button id="mBtnRange" class="tool-btn" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ®">ğŸ“…</button>
            <button id="mBtnRandom" class="tool-btn" aria-label="Ø¹Ø±Ø¶ Ø¹Ø´ÙˆØ§Ø¦ÙŠ">ğŸ”€</button>
            <button id="mBtnViewAll" class="tool-btn" aria-label="Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª">ğŸ“„</button>
            <button id="mBtnPickStudent" class="tool-btn" aria-label="Ø§Ø®ØªÙŠØ§Ø± Ø·Ø§Ù„Ø¨">ğŸ‘¤</button>
        </div>
        <!-- Ø®Ù„ÙÙŠØ© Ù…Ø¹ØªÙ…Ø© Ù„Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ -->
        <div id="pickerBackdrop" class="picker-backdrop" aria-hidden="true"></div>
    </div>

    <div class="left-progress" aria-hidden="true">
        <div class="left-fill" id="leftFill"></div>
        <div class="left-label" id="leftLabel">0/0</div>
    </div>

    <div id="rangeModal" class="range-modal" style="display:none; position: fixed; inset: 0; z-index:1000;">
        <div class="modal-backdrop" style="position:absolute; inset:0; background: rgba(0,0,0,.35);"></div>
        <div class="modal-card" style="position:relative; margin: 10vh auto; max-width: 560px; background:#fff; border-radius:18px; border:1px solid var(--color-glass-border); padding:22px; box-shadow:0 16px 40px rgba(0,0,0,.18);">
            <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                <h3 style="margin:0; font-family: var(--font-header); color: var(--color-primary-text); font-weight:900;">ğŸ“… Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¯Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ®</h3>
                <button id="btnCancelRange" class="ctrl-btn" aria-label="Ø¥ØºÙ„Ø§Ù‚">âœ–</button>
            </div>
            <p style="margin:0 0 12px; color: var(--color-secondary-text);">Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙƒØ±Ù…ÙŠÙ† Ø¶Ù…Ù† Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ø²Ù…Ù†ÙŠ.</p>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
                <label style="text-align:right; color: var(--color-secondary-text); font-weight:800;">Ù…Ù†
                    <input id="startDate" type="date" style="width:100%; margin-top:6px; padding:12px; border-radius:12px; border:1px solid #e5e7eb; font-family: var(--font-body);">
                </label>
                <label style="text-align:right; color: var(--color-secondary-text); font-weight:800;">Ø¥Ù„Ù‰
                    <input id="endDate" type="date" style="width:100%; margin-top:6px; padding:12px; border-radius:12px; border:1px solid #e5e7eb; font-family: var(--font-body);">
                </label>
            </div>
            <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:16px;">
                <button id="btnClearRange" class="ctrl-btn" title="Ø¥Ù„ØºØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø¯Ù‰">Ù…Ø³Ø­</button>
                <button id="btnApplyRange" class="ctrl-btn primary">ØªØ·Ø¨ÙŠÙ‚</button>
            </div>
        </div>
    </div>
    
    <div id="studentPicker" class="picker-panel">
        <div class="picker-header">
            <input id="studentSearch" type="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø·Ø§Ù„Ø¨...">
            <button id="btnUnpin" class="ctrl-btn" aria-label="Ø¥Ù„ØºØ§Ø¡ ØªØ«Ø¨ÙŠØª">âœ–</button>
        </div>
        <ul id="studentList" class="picker-list"></ul>
        <div id="studentEmpty" class="picker-empty" style="display:none;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>
    </div>
    
    <div id="allCardsModal" class="all-cards-modal">
        <div class="all-cards-content">
            <div id="printHeader" style="position:relative; background: linear-gradient(120deg, var(--color-card-secondary), var(--color-card-primary)); border-radius:16px; padding:16px; color:#fff;">
                <div style="font-family: var(--font-header); font-size: 2em; font-weight:900; text-align:center;">ğŸ† Ù„Ù€ÙˆØ­Ù€Ù€Ø© Ù…ÙƒØ§ÙØ¢Øª Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ ğŸ†</div>
                <div class="cele-decor" aria-hidden="true" style="position:absolute; inset:0; pointer-events:none;">
                    <div style="position:absolute; top:-8px; left:12px; font-size:28px;">ğŸ†âœ¨</div>
                    <div style="position:absolute; bottom:-6px; right:18px; font-size:26px;">ğŸŒŸğŸ‰</div>
                </div>
            </div>
            <div id="miniCardsGrid" class="cards-grid"></div>
        </div>
        
        <div class="modal-footer-bar">
            <div class="ctrl-group">
                <button id="btnCloseAllCards" class="tool-btn" aria-label="Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø±Ø¶">âœ–<span class="tooltip">Ø¥ØºÙ„Ø§Ù‚</span></button>
                <button id="btnShareAllCards" class="tool-btn" aria-label="Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">ğŸ“¤<span class="tooltip">Ù…Ø´Ø§Ø±ÙƒØ©</span></button>
                <button id="btnPrintAllCards" class="tool-btn" aria-label="Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">ğŸ–¨ï¸<span class="tooltip">Ø·Ø¨Ø§Ø¹Ø©</span></button>
            </div>
        </div>
    </div>

    <!-- html2canvas Ù„ØªØ­ÙˆÙŠÙ„ Ø¹Ù†Ø§ØµØ± HTML Ø¥Ù„Ù‰ ØµÙˆØ±Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©/Ø§Ù„ØªØ­Ù…Ù€ÙŠÙ„ -->
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <script>
        
        // ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†Ø´ÙˆØ± ÙˆØ§Ù„ÙØ¹Ø§Ù„ Ù„ØªØ·Ø¨ÙŠÙ‚ Google Apps Script
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzyF8Le2goK3HQv0pnnrYz9IipXhzCkcZnsC-IoW_fjp_DD45hHDxvxSDRFRJ-mAEO8/exec';


        const MAX_RETRIES = 3;
        const INITIAL_DELAY_MS = 1000;
        const CONTAINER_ID = 'honorRoll';
        const DISPLAY_DURATION = 5000; 
        const TRANSITION_DURATION = 700; 
        const REFRESH_INTERVAL_MS = 30000; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ù„ÙÙŠØ© ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
        const ORDER_MODE = 'random';
        // ÙŠÙ…ÙƒÙ† Ø¶Ø¨Ø· Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù†Ø´Ø± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ø¥Ù† Ø±ØºØ¨Øª
        const DEFAULT_CLASS_ID = '';


        let allStudentsData = [];
        let currentIndex = 0;
        let rotationInterval = null;
        let currentNamesOrder = [];
        let sortMode = 'random'; // 'random' | 'top' | 'oldest'
        let activeRange = null; // {startISO, endISO}
        let pinnedStudent = null; // Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…Ø«Ø¨Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©

        

        function createLargeCard(index, name, reward, photoUrl) {
            const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--color-card-primary').trim();
            const placeholder = `https://placehold.co/300x300/F0F8FF/${primaryColor.replace('#', '')}?text=Ø·Ø§Ù„Ø¨+Ù…Ù…ÙŠØ²`;
            
            return `
                <div class="large-card" data-index="${index}">
                    <div class="card-details">
                        <div style="margin-bottom: 20px;">
                            <p style="font-size: 1.5em; color: var(--color-secondary-text); margin: 0 0 5px;">Ù†Ù‚Ø¯Ù… Ø§Ù„ØªÙ‡Ù†Ø¦Ø© Ù„Ù„Ø·Ø§Ù„Ø¨</p>
                            <div class="student-name">${name}</div>
                            <p style="font-size: 1.2em; color: var(--color-secondary-text); margin: 5px 0 0;">Ù„ØªØ­Ù‚ÙŠÙ‚Ù‡ Ø¥Ù†Ø¬Ø§Ø²:</p>
                        </div>
                        
                        <span class="reward-tag">${reward || 'Ù…ÙƒØ§ÙØ£Ø© Ù…Ù…ÙŠØ²Ø©'}</span>
                    </div>
                    <div class="photo-area">
                        <img 
                            src="${photoUrl || placeholder}" 
                            class="student-photo" 
                            alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ù…ÙƒØ±Ù… ${name}"
                            onerror="this.onerror=null; this.src='${placeholder}';"
                            referrerpolicy="no-referrer"
                        >
                    </div>
                </div>
            `;
        }

        async function callGAS(functionName, args){
            const payload = { functionName, args };
            let attempt = 0;
            let lastErr;
            while (attempt <= MAX_RETRIES){
                try {
                    const res = await fetch(WEB_APP_URL, {
                        method: 'POST',
                        // âœ… Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ø­Ù„ Ù„ØªØ¬Ø§ÙˆØ² Ù…Ø´ÙƒÙ„Ø© CORS ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª
                        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                        body: JSON.stringify(payload)
                    });
                    if (!res.ok) throw new Error('HTTP ' + res.status);
                    const text = await res.text();
                    let data;
                    try { data = JSON.parse(text); } catch { throw new Error('Ø±Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­: Ø§Ø³ØªÙ‚Ø¨Ù„Ù†Ø§ Ù†Øµ ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ JSON'); }
                    if (data && data.success === false) throw new Error(data.error || 'ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨');
                    return data.data || data;
                } catch (e) {
                    lastErr = e;
                    if (attempt === MAX_RETRIES) break;
                    const delay = INITIAL_DELAY_MS * Math.pow(2, attempt);
                    await new Promise(r => setTimeout(r, delay));
                    attempt++;
                }
            }
            throw lastErr || new Error('ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©');
        }

        async function fetchFromSystemByClass(classId, opts={}){
            const container = document.getElementById(CONTAINER_ID);
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Promise.allSettled Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªÙˆÙ‚Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø°Ø§ ÙØ´Ù„ Ø£Ø­Ø¯ Ø§Ù„Ø·Ù„Ø¨ÙŠÙ† (Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØµÙ„ ØºÙŠØ± Ø­Ø§Ø³Ù…Ø©)
                const [classInfoResult, rawResult] = await Promise.allSettled([
                    callGAS('getClassInfo', [classId]),
                    callGAS('getClassPositiveLogsToday', [classId])
                ]);
                
                if (rawResult.status === 'rejected') {
                    throw new Error(rawResult.reason.message || 'ÙØ´Ù„ Ø¬Ù„Ø¨ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª.');
                }
                
                const classInfo = classInfoResult.status === 'fulfilled' ? (classInfoResult.value || {}) : {};
                const raw = rawResult.value || [];

                let list = Array.isArray(raw) ? raw : [];
                const topN = Number(opts.topN || 0);
                if (topN > 0) list = list.slice(0, topN);
                const threshold = opts.minScore != null ? Number(opts.minScore) : null;
                if (threshold != null && !Number.isNaN(threshold)) {
                    list = list.filter(s => Number(s.Count || 0) >= threshold);
                }
                
                const subtitle = classInfo && (classInfo.ClassName || classInfo.Section)
                  ? `${classInfo.ClassName || classId}${classInfo.Section ? ' - ' + classInfo.Section : ''}`
                  : String(classId);
                  
                const mapped = list.map(s => {
                    const count = Number(s.Count || 1);
                    const rewardHTML = `${subtitle} <span class="pos-badge">+${count}</span>`;
                    return [
                        s.StudentName,
                        rewardHTML,
                        s.PhotoURL || ''
                    ];
                });
                displayData(mapped);
            } catch (error) {
                console.error('Error fetching system data:', error);
                if (allStudentsData.length === 0) {
                    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙˆØ§Ø¶Ø­Ø©
                    container.innerHTML = `<div class="message-box" style="color:#DC2626; border-color:#DC2626; font-size:1.2em;">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª. <br>Ø§Ù„Ø³Ø¨Ø¨: ${error.message} <br>ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© ÙƒÙˆØ¯ Google Apps Script ÙˆØ¶Ø¨Ø· Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø´Ø± Ø¹Ù„Ù‰ "Anyone".</div>`;
                }
                clearInterval(rotationInterval);
            }
        }

        function displayData(data) {
            const container = document.getElementById(CONTAINER_ID);
            
            clearInterval(rotationInterval);

            if (data.error || !Array.isArray(data) || data.length === 0) {
                const message = data.error 
                    ? `Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…: ${data.error}` 
                    : `Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ù…Ø§Ø¡ Ù…ÙƒØ±Ù…ÙŠÙ† Ø­Ø§Ù„ÙŠØ§Ù‹.`;
                container.innerHTML = `<div class="message-box" style="color:var(--color-card-primary); border-color:var(--color-card-primary);">${message}</div>`;
                allStudentsData = [];
                return;
            }

            allStudentsData = data;
            
            container.innerHTML = '';
            container.insertAdjacentHTML('afterbegin', '<div id="confettiEffect" class="confetti-effect"></div>');
            
            allStudentsData.forEach((row, index) => {
                const name = row[0];
                const reward = row[1];
                const photoUrl = row[2];
                if (name) {
                    container.insertAdjacentHTML('beforeend', createLargeCard(index, name, reward, photoUrl));
                }
            });
            
            const cards = container.querySelectorAll('.large-card');
            if (cards.length === 0) {
                 container.innerHTML = `<div class="message-box" style="color:var(--color-card-primary); border-color:var(--color-card-primary);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ù‚Ø§Ø· Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø§Ù„ÙŠÙˆÙ….</div>`;
                 return;
            }

            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø·Ø§Ù„Ø¨ Ù…Ø«Ø¨ØªØŒ Ø§Ø¹Ø±Ø¶Ù‡ ÙÙ‚Ø· ÙˆØ£ÙˆÙ‚Ù Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
            if (pinnedStudent) {
                const idx = allStudentsData.findIndex(r => (r && r[0]) === pinnedStudent);
                currentIndex = idx >= 0 ? idx : 0;
                showCard(currentIndex);
                clearInterval(rotationInterval);
            } else {
                currentIndex = 0;
                showCard(currentIndex);
                if (cards.length > 1) {
                    rotationInterval = setInterval(rotateCards, DISPLAY_DURATION + TRANSITION_DURATION);
                }
            }
        }
        
        function rotateCards() {
            const container = document.getElementById(CONTAINER_ID);
            const cards = container.querySelectorAll('.large-card');
            if (cards.length < 2) return;

            const currentCard = cards[currentIndex];
            const nextIndex = (currentIndex + 1) % cards.length;
            
            currentCard.classList.remove('active');
            currentCard.classList.add('exit');
            
            // ØªØ´ØºÙŠÙ„ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚ØµØ§ØµØ§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
            triggerConfetti();

            setTimeout(() => {
                currentCard.classList.remove('exit'); 
                showCard(nextIndex);
                currentIndex = nextIndex;
            }, TRANSITION_DURATION);
        }

        function showCard(index) {
             const container = document.getElementById(CONTAINER_ID);
             const cards = container.querySelectorAll('.large-card');
             if (cards.length === 0) return;
             
             cards.forEach(card => card.classList.remove('active'));
            
             const nextCard = cards[index];
             nextCard.classList.add('active');
             updateProgress(index, cards.length);
        }

        function updateProgress(idx, total){
            const fill = document.getElementById('leftFill');
            const label = document.getElementById('leftLabel');
            if (!fill || !label || !total) return;
            const percent = Math.round(((idx+1) / total) * 100);
            fill.style.height = percent + '%';
            label.textContent = `${idx+1}/${total}`;
        }
        
        function triggerConfetti(){
            const confettiContainer = document.getElementById('confettiEffect');
            if (!confettiContainer) return;
            confettiContainer.innerHTML = '';
            const count = 50;
            const colors = [
                getComputedStyle(document.documentElement).getPropertyValue('--color-card-primary').trim(),
                getComputedStyle(document.documentElement).getPropertyValue('--color-highlight-text').trim(),
                '#3498db',
                '#f1c40f'
            ];
            for (let i = 0; i < count; i++) {
                const conf = document.createElement('div');
                conf.className = 'confetti';
                conf.style.left = (Math.random() * 100) + '%';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.animationDelay = (Math.random() * 0.5) + 's';
                conf.style.animationDuration = (2.5 + Math.random() * 1.5) + 's';
                confettiContainer.appendChild(conf);
            }
            setTimeout(() => { if (confettiContainer) confettiContainer.innerHTML = ''; }, 4000);
        }
        
        

        // Ø®Ù„Ø· Ø¹Ø§Ø¯Ù„ (Fisher-Yates)
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function updateClock() {
            const dateElement = document.getElementById('currentDateTime');
            if (!dateElement) return;

            const now = new Date();
            
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            
            const timeOptions = {
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit',
                hour12: true 
            };

            const formattedDate = new Intl.DateTimeFormat('ar-EG', dateOptions).format(now);
            const formattedTime = new Intl.DateTimeFormat('ar-EG', timeOptions).format(now);

            dateElement.innerHTML = `<span style="color:var(--color-primary-text);">${formattedDate}</span> | <span style="font-weight: 700; color: var(--color-card-primary);">Ø§Ù„Ø³Ø§Ø¹Ø©: ${formattedTime}</span>`;
        }


        // Ø¬Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø± Ù…Ù† GAS Ù„Ù„Ø¯Ø§Ù„Ø© fetchStudentsData
        async function fetchAndDisplay(){
            const container = document.getElementById(CONTAINER_ID);
            try {
                let data;
                if (activeRange && activeRange.startISO && activeRange.endISO) {
                    data = await callGAS('fetchPositiveLogsInRange', [activeRange.startISO, activeRange.endISO]);
                } else {
                    data = await callGAS('fetchPositiveLogsToday', []);
                }
                const newData = Array.isArray(data) ? data : [];

                // Ø¨Ù†Ø§Ø¡ Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù„Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                const newNames = newData.map(r => r && r[0]).filter(Boolean);
                const currentSet = new Set(currentNamesOrder);
                const newSet = new Set(newNames);

                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø£ÙˆÙ„ ØªØ­Ù…ÙŠÙ„: Ø§Ø®Ù„Ø· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ù… Ø§Ø¹Ø±Ø¶
                if (allStudentsData.length === 0) {
                    let initial = applyOrdering(newData);
                    displayData(initial);
                    currentNamesOrder = initial.map(r => r[0]);
                    return;
                }

                // Ø¥Ø°Ø§ Ù„Ù… ØªØªØºÙŠØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ù†ÙØ³ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ØªÙ…Ø§Ù…Ù‹Ø§) ÙÙ„Ø§ ØªØ¹ÙŠØ¯ Ø§Ù„Ø¨Ù†Ø§Ø¡
                const sameSize = currentNamesOrder.length === newNames.length;
                let identical = sameSize;
                if (identical) {
                    for (let name of newNames) { if (!currentSet.has(name)) { identical = false; break; } }
                }
                if (identical) return; // Ù„Ø§ ØªØºÙŠÙŠØ± Ø¨ØµØ±ÙŠÙ‹Ø§

                // ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙ‚Ø±: Ø§Ø­ØªÙØ¸ Ø¨ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ø£Ø¶Ù Ø§Ù„ÙˆØ§ÙØ¯ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
                const byName = Object.fromEntries(newData.map(r => [r[0], r]));
                const kept = currentNamesOrder.filter(n => newSet.has(n)).map(n => byName[n]).filter(Boolean);
                const newcomers = newNames.filter(n => !currentSet.has(n)).map(n => byName[n]).filter(Boolean);
                shuffle(newcomers);
                const merged = applyOrdering(kept.concat(newcomers));
                displayData(merged);
                currentNamesOrder = merged.map(r => r[0]);
            } catch (error) {
                console.error('Error fetching GAS data:', error);
                if (allStudentsData.length === 0) {
                    container.innerHTML = `<div class=\"message-box\" style=\"color:#DC2626; border-color:#DC2626; font-size:1.2em;\">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª. <br>Ø§Ù„Ø³Ø¨Ø¨: ${error.message}</div>`;
                }
                clearInterval(rotationInterval);
            }
        }

        function applyOrdering(rows){
            let arr = Array.isArray(rows) ? [...rows] : [];
            if (sortMode === 'top') {
                arr.sort((a,b) => (Number(b?.[3]||0) - Number(a?.[3]||0)));
            } else if (sortMode === 'oldest') {
                arr.sort((a,b) => (Number(a?.[4]||0) - Number(b?.[4]||0)));
            } else if (sortMode === 'random') {
                shuffle(arr);
            }
            return arr;
        }

        // --- Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§Ù„Ø·Ø¨Ø§Ø¹Ø© ---
        
        function createMiniCard(name, reward, photoUrl) {
            const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--color-card-primary').trim();
            const placeholder = `https://placehold.co/100x100/F0F8FF/${primaryColor.replace('#', '')}?text=Ø·Ø§Ù„Ø¨`;
            
            // ØªÙ†Ø¸ÙŠÙ Ø´Ø§Ø±Ø© Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØµØºØ±Ø©
            // Ù†Ø³ØªØ®Ø¯Ù… ØªØ¹Ø§Ø¨ÙŠØ± Ù…Ù†ØªØ¸Ù…Ø© Ù„Ø­Ø°Ù ÙˆØ³Ù… span.pos-badge Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
            const cleanReward = reward.replace(/<span class="pos-badge">.*?<\/span>/g, '').trim();

            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Ù‚Ø§Ø· Ù…Ù† Ø§Ù„Ø´Ø§Ø±Ø© Ø¯Ø§Ø®Ù„ reward Ø¥Ù† ÙˆÙØ¬Ø¯Øª
            let points = '';
            const m = reward.match(/<span class=\"pos-badge\">\+(\d+)<\/span>/);
            if (m) points = m[1];
            const classLabel = cleanReward || '';

            return `
                <div class="mini-card" data-student-name="${name.replace(/"/g,'&quot;')}" data-points="${points}" data-classlabel="${classLabel.replace(/"/g,'&quot;')}">
                    <div class="mini-photo-area">
                        <img 
                            src="${photoUrl || placeholder}" 
                            alt="ØµÙˆØ±Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ ${name}"
                            onerror="this.onerror=null; this.src='${placeholder}';"
                            referrerpolicy="no-referrer"
                        >
                    </div>
                    <div class="mini-name">${name}</div>
                    <div class="mini-meta">
                        <span class="dot" aria-hidden="true"></span>
                        <span class="meta-text">${classLabel}</span>
                    </div>
                    ${points ? `<div class="points-badge">+${points}</div>` : ''}
                    <div class="mini-actions">
                        <button class="mini-icon btn-share-one" aria-label="Ù…Ø´Ø§Ø±ÙƒØ©">
                            ğŸ”—
                            <span class="tip">Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</span>
                        </button>
                        <button class="mini-icon btn-print-one" aria-label="Ø·Ø¨Ø§Ø¹Ø©">
                            ğŸ–¨ï¸
                            <span class="tip">Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø·Ø§Ù„Ø¨</span>
                        </button>
                    </div>
                </div>
            `;
        }

        function populateAllCardsModal() {
            const grid = document.getElementById('miniCardsGrid');
            const modal = document.getElementById('allCardsModal');
            // Ø¥Ø®ÙØ§Ø¡ Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ®Ù„ÙÙŠØªÙ‡ Ø¥Ù† ÙƒØ§Ù†Øª Ø¸Ø§Ù‡Ø±Ø© Ù„ØªØ¬Ù†Ø¨ ØªØ¹ØªÙŠÙ… Ø§Ù„Ø´Ø§Ø´Ø©
            try {
                const picker = document.getElementById('studentPicker');
                const backdrop = document.getElementById('pickerBackdrop');
                if (picker) { picker.classList.remove('show'); picker.style.display='none'; }
                if (backdrop) backdrop.style.display='none';
            } catch {}
            
            grid.innerHTML = ''; 
            
            if (allStudentsData.length === 0) {
                 grid.innerHTML = '<p style="text-align:center; font-size:1.4em; color:var(--color-secondary-text);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù„Ø¹Ø±Ø¶ Ø­Ø§Ù„ÙŠØ§Ù‹.</p>';
                 return;
            }

            allStudentsData.forEach(row => {
                const name = row[0];
                const reward = row[1];
                const photoUrl = row[2];
                grid.insertAdjacentHTML('beforeend', createMiniCard(name, reward, photoUrl));
            });
            // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©/Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù„ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø© Ù…ØµØºØ±Ø© Ø¨Ø¹Ø¯ ØªÙˆÙ„ÙŠØ¯Ù‡Ø§
            grid.querySelectorAll('.mini-card').forEach((cardEl, idx) => {
                const btnShare = cardEl.querySelector('.btn-share-one');
                const btnPrint = cardEl.querySelector('.btn-print-one');
                if (btnShare) btnShare.addEventListener('click', async () => {
                    try {
                        const studentName = cardEl.getAttribute('data-student-name') || '';
                        const url = new URL(window.location.href);
                        url.searchParams.set('view', 'all');
                        url.searchParams.set('student', encodeURIComponent(studentName));
                        const shareData = { title: 'Ø¨Ø·Ø§Ù‚Ø© ØªÙƒØ±ÙŠÙ…', text: `Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø·Ø§Ù„Ø¨ ${studentName}`, url: url.toString() };
                        if (navigator.share) { await navigator.share(shareData); }
                        else {
                            await navigator.clipboard.writeText(shareData.url);
                            alert('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©');
                        }
                    } catch(_){}
                });
                if (btnPrint) btnPrint.addEventListener('click', async () => {
                    try {
                        await printElementAsImage(cardEl, `honor-card-${idx+1}.png`);
                    } catch(_){}
                });
            });
            
            modal.classList.add('show');
        }

        async function exportElementToImage(el, filename = 'card.png'){
            const canvas = await html2canvas(el, { backgroundColor: null, scale: 2, useCORS: true });
            return new Promise(resolve => {
                canvas.toBlob(blob => {
                    resolve({ blob, dataUrl: canvas.toDataURL('image/png'), filename });
                }, 'image/png', 1);
            });
        }

        function downloadBlob(blob, filename){
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = filename; a.click();
            URL.revokeObjectURL(url);
        }

        async function shareBlobAsImage(blob, filename){
            if (navigator.canShare && navigator.canShare({ files: [new File([blob], filename, { type: 'image/png' })] })){
                try {
                    await navigator.share({ files: [new File([blob], filename, { type: 'image/png' })], title: 'Ø¨Ø·Ø§Ù‚Ø© ØªÙƒØ±ÙŠÙ…' });
                    return true;
                } catch(e){ return false; }
            }
            return false;
        }

        async function handleShareAllAsImage(){
            // Ù…Ø´Ø§Ø±ÙƒØ© ÙƒØ±Ø§Ø¨Ø· ÙŠÙØªØ­ Ø§Ù„Ù…Ø¹Ø±Ø¶
            const url = new URL(window.location.href);
            url.searchParams.set('view', 'all');
            const shareData = { title: 'Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙƒØ±Ù…ÙŠÙ†', text: 'Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ÙƒØ±Ù…ÙŠÙ†', url: url.toString() };
            if (navigator.share) { try { await navigator.share(shareData); return; } catch(_){} }
            await navigator.clipboard.writeText(shareData.url);
            alert('ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©');
        }

        async function printElementAsImage(el, filename='card.png'){
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ø­ØªÙØ§Ù„ÙŠØ© Ø¬Ù…ÙŠÙ„Ø©
            const name = el.querySelector('.mini-name')?.textContent?.trim() || '';
            const classLabel = el.getAttribute('data-classlabel') || '';
            const points = el.getAttribute('data-points') || '';
            const imgSrc = el.querySelector('img')?.getAttribute('src') || '';
            const w = window.open('', '_blank');
            const styles = `
                html,body{margin:0;padding:0;background:#f8fafc}
                body{font-family:'Cairo',sans-serif}
                .sheet{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
                .card{max-width:720px;width:100%;border-radius:20px;border:2px solid #DCFCE7;background:linear-gradient(135deg, rgba(236,253,245,1), rgba(209,250,229,1)); box-shadow:0 20px 60px rgba(0,0,0,.12); padding:24px; position:relative; overflow:hidden}
                .header{font-family:'Changa',sans-serif; font-size:28px; font-weight:900; text-align:center; color:#065f46; margin-bottom:12px}
                .cele{position:absolute; inset:0; pointer-events:none; font-size:28px}
                .cele .tl{position:absolute; top:8px; left:12px} .cele .br{position:absolute; bottom:8px; right:12px}
                .body{display:flex; gap:20px; align-items:center; justify-content:center; flex-wrap:wrap}
                .photo{width:180px; height:180px; border-radius:50%; overflow:hidden; border:6px solid #A7F3D0; box-shadow:0 10px 30px rgba(0,0,0,.15)}
                .photo img{width:100%; height:100%; object-fit:cover}
                .info{min-width:260px; text-align:center}
                .name{font-family:'Changa',sans-serif; font-size:34px; font-weight:900; color:#065f46; margin-bottom:8px}
                .meta{display:flex; align-items:center; justify-content:center; gap:10px; color:#065f46; font-weight:800; margin-bottom:10px}
                .dot{width:10px; height:10px; border-radius:50%; background:#10b981; box-shadow:0 0 0 4px rgba(16,185,129,.2)}
                .pb{display:inline-block; background:linear-gradient(45deg,#10b981,#34d399); color:#fff; padding:8px 14px; border-radius:999px; font-weight:900; font-family:'Changa',sans-serif; box-shadow:0 6px 16px rgba(16,185,129,.25)}
                .footer{margin-top:14px; text-align:center; color:#047857; font-weight:800}
            `;
            w.document.write(`<!doctype html><html lang=\"ar\" dir=\"rtl\"><head><meta charset=\"utf-8\"><title>Ø·Ø¨Ø§Ø¹Ø© Ø¨Ø·Ø§Ù‚Ø©</title><link href=\"https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&family=Changa:wght@600;800&display=swap\" rel=\"stylesheet\"><style>${styles}</style></head><body>`);
            w.document.write(`
                <div class="sheet">
                  <div class="card">
                    <div class="header">ğŸ† Ù„Ù€ÙˆØ­Ù€Ù€Ø© Ù…ÙƒØ§ÙØ¢Øª Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ ğŸ†</div>
                    <div class="cele" aria-hidden="true">
                      <div class="tl">ğŸ†âœ¨ğŸ‰</div>
                      <div class="br">ğŸŒŸğŸŠğŸ‰</div>
                    </div>
                    <div class="body">
                      <div class="photo"><img src="${imgSrc}" alt="${name}"></div>
                      <div class="info">
                        <div class="name">${name}</div>
                        <div class="meta"><span class="dot"></span><span>${classLabel}</span></div>
                        ${points ? `<div class="pb">+${points}</div>` : ''}
                        <div class="footer">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§ Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø±Ø§Ø¦Ø¹! ğŸ‰</div>
                      </div>
                    </div>
                  </div>
                </div>
            `);
            w.document.write('</body></html>');
            w.document.close();
            w.focus();
            w.onload = () => w.print();
        }
        

        // Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨
        const studentPicker = document.getElementById('studentPicker');
        const studentSearch = document.getElementById('studentSearch');
        const studentList = document.getElementById('studentList');
        const studentEmpty = document.getElementById('studentEmpty');
        const btnUnpin = document.getElementById('btnUnpin');
        const pickerBackdrop = document.getElementById('pickerBackdrop');

        function buildStudentList(filter=''){
            const names = (allStudentsData || []).map(r => r && r[0]).filter(Boolean).sort((a,b)=> a.localeCompare(b,'ar'));    
            const filtered = filter ? names.filter(n => n.includes(filter)) : names;
            studentList.innerHTML = '';
            if (filtered.length === 0){ studentEmpty.style.display='block'; return; }
            studentEmpty.style.display='none';
            filtered.forEach(n => {
                const li = document.createElement('li');
                li.textContent = n;
                if (pinnedStudent === n){
                    const span = document.createElement('span');
                    span.className = 'pin-badge';
                    span.textContent = 'Ù…Ø«Ø¨Ù‘Øª';
                    li.appendChild(span);
                }
                li.addEventListener('click', () => {
                    pinnedStudent = n;
                    closeStudentPicker();
                    // Ø£Ø¹Ø¯ Ø§Ù„Ø¹Ø±Ø¶ Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø·Ø§Ù„Ø¨ ÙˆØ¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¯ÙˆØ±Ø§Ù†
                    displayData(allStudentsData);
                });
                studentList.appendChild(li);
            });
        }

        // Ø¯ÙˆØ§Ù„ ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚/ØªØ¨Ø¯ÙŠÙ„ Ù…Ù†ØªÙ‚ÙŠ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù„Ø¶Ù…Ø§Ù† Ù…ÙˆØ«ÙˆÙ‚ÙŠØ© Ø£Ø¹Ù„Ù‰
        function openStudentPicker(){
            const ensureData = allStudentsData.length ? Promise.resolve() : fetchAndDisplay();
            ensureData.then(()=>{
                buildStudentList('');
                studentPicker.classList.add('show');
                studentPicker.style.display = 'block';
                if (pickerBackdrop) {
                    const isMob = document.documentElement.classList.contains('is-mobile');
                    pickerBackdrop.style.display = isMob ? 'block' : 'none';
                }
                studentSearch.value = '';
                setTimeout(()=>{ try { studentSearch.focus(); } catch {} }, 0);
            });
        }
        function closeStudentPicker(){
            studentPicker.classList.remove('show');
            studentPicker.style.display = 'none';
            if (pickerBackdrop) pickerBackdrop.style.display = 'none';
        }
        function toggleStudentPicker(){
            if (studentPicker.classList.contains('show')) closeStudentPicker(); else openStudentPicker();
        }
        btnPickStudent.addEventListener('click', (ev) => {
            ev.stopPropagation();
            toggleStudentPicker();
        });
        // Ø¯Ø¹Ù… Ø²Ø± Ø§Ù„Ù‡Ø§ØªÙ: Ø§Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø³Ø¨Ø¨ Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ù†Ù‚Ø± Ø§Ù„Ø¹Ø§Ù…
        const mBtnPickStudent = document.getElementById('mBtnPickStudent');
        if (mBtnPickStudent) {
            mBtnPickStudent.addEventListener('click', (ev)=>{ ev.stopPropagation(); toggleStudentPicker(); });
        }
        studentSearch.addEventListener('input', (e)=> buildStudentList(e.target.value.trim()));
        btnUnpin.addEventListener('click', ()=> { pinnedStudent = null; closeStudentPicker(); displayData(allStudentsData); });
        // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù„ÙˆØ­Ø©
        document.addEventListener('click', (e)=>{
            const mobileBtn = document.getElementById('mBtnPickStudent');
            const mobileBar = document.getElementById('mobileToolbar');
            const within = studentPicker.contains(e.target)
                || btnPickStudent.contains(e.target)
                || (mobileBtn && mobileBtn.contains(e.target))
                || (mobileBar && mobileBar.contains(e.target));
            if (!within) { closeStudentPicker(); }
        });
        if (pickerBackdrop) pickerBackdrop.addEventListener('click', closeStudentPicker);
        
        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', () => {
            // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ù‡Ø§ØªÙ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„Ù‡Ø§ØªÙ Ø£Ø³ÙÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
            const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent) || window.matchMedia('(pointer:coarse)').matches;
            if (isMobile) document.documentElement.classList.add('is-mobile');
            
            // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© ÙˆØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ±ÙŠ Ø¨Ø¯ÙˆÙ† ÙˆÙ…ÙŠØ¶
            fetchAndDisplay();
            setInterval(fetchAndDisplay, REFRESH_INTERVAL_MS);
            
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
            updateClock();
            setInterval(updateClock, 1000); 

            const btnRandom = document.getElementById('btnRandom');
            const btnOldest = document.getElementById('btnOldest');
            const btnTop = document.getElementById('btnTop');
            const btnRange = document.getElementById('btnRange');
            const btnViewAll = document.getElementById('btnViewAll'); // Ø§Ù„Ø²Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
            const btnPickStudent = document.getElementById('btnPickStudent');
            // Ø£Ø²Ø±Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„Ù‡Ø§ØªÙ
            const mBtnOldest = document.getElementById('mBtnOldest');
            const mBtnTop = document.getElementById('mBtnTop');
            const mBtnRange = document.getElementById('mBtnRange');
            const mBtnRandom = document.getElementById('mBtnRandom');
            const mBtnViewAll = document.getElementById('mBtnViewAll');
            const mBtnPickStudent = document.getElementById('mBtnPickStudent');
            
            const allCardsModal = document.getElementById('allCardsModal');
            const btnCloseAllCards = document.getElementById('btnCloseAllCards');
            const btnPrintAllCards = document.getElementById('btnPrintAllCards');
            const btnShareAllCards = document.getElementById('btnShareAllCards');

            function setActive(btn){
                [btnRandom, btnOldest, btnTop, btnRange].forEach(b => b.classList.remove('active'));
                if (btn) btn.classList.add('active');
            }
            // Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø¹Ø´ÙˆØ§Ø¦ÙŠ
            setActive(btnRandom);
            btnRandom.addEventListener('click', () => {
                sortMode = 'random';
                activeRange = null;
                setActive(btnRandom);
                if (allStudentsData.length) {
                    const ordered = applyOrdering(allStudentsData);
                    displayData(ordered);
                    currentNamesOrder = ordered.map(r => r[0]);
                } else {
                    fetchAndDisplay();
                }
            });
            btnOldest.addEventListener('click', () => {
                sortMode = 'oldest';
                activeRange = null;
                setActive(btnOldest);
                if (allStudentsData.length) {
                    const ordered = applyOrdering(allStudentsData);
                    displayData(ordered);
                    currentNamesOrder = ordered.map(r => r[0]);
                } else {
                    fetchAndDisplay();
                }
            });
            btnTop.addEventListener('click', () => {
                sortMode = 'top';
                activeRange = null;
                setActive(btnTop);
                if (allStudentsData.length) {
                    const ordered = applyOrdering(allStudentsData);
                    displayData(ordered);
                    currentNamesOrder = ordered.map(r => r[0]);
                } else {
                    fetchAndDisplay();
                }
            });
            // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‡Ø§ØªÙ Ø¨Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„Ù…Ù†Ø·Ù‚
            if (mBtnOldest) mBtnOldest.addEventListener('click', () => btnOldest.click());
            if (mBtnTop) mBtnTop.addEventListener('click', () => btnTop.click());
            if (mBtnRange) mBtnRange.addEventListener('click', () => btnRange.click());
            if (mBtnRandom) mBtnRandom.addEventListener('click', () => btnRandom.click());
            if (mBtnViewAll) mBtnViewAll.addEventListener('click', () => btnViewAll.click());
            if (mBtnPickStudent && btnPickStudent) mBtnPickStudent.addEventListener('click', () => btnPickStudent.click());
            const rangeModal = document.getElementById('rangeModal');
            const startDateInput = document.getElementById('startDate');
            const endDateInput = document.getElementById('endDate');
            const btnApplyRange = document.getElementById('btnApplyRange');
            const btnCancelRange = document.getElementById('btnCancelRange');
            const btnClearRange = document.getElementById('btnClearRange');

            btnRange.addEventListener('click', () => {
                rangeModal.style.display = 'block';
            });
            btnCancelRange.addEventListener('click', () => {
                rangeModal.style.display = 'none';
            });
            btnApplyRange.addEventListener('click', async () => {
                const s = startDateInput.value;
                const e = endDateInput.value;
                if (!s || !e) return;
                activeRange = { startISO: s, endISO: e };
                sortMode = 'top';
                setActive(btnRange);
                rangeModal.style.display = 'none';
                await fetchAndDisplay();
            });
            if (btnClearRange) {
                btnClearRange.addEventListener('click', () => {
                    startDateInput.value = '';
                    endDateInput.value = '';
                    startDateInput.focus();
                });
            }
            
            // Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø²Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµØºØ±Ø©
            btnViewAll.addEventListener('click', populateAllCardsModal);
            
            btnCloseAllCards.addEventListener('click', () => {
                allCardsModal.classList.remove('show');
            });
            // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª/Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£Ùˆ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            allCardsModal.addEventListener('click', (e) => {
                const content = e.target.closest('.all-cards-content');
                const footer = e.target.closest('.modal-footer-bar');
                if (!content && !footer) {
                    allCardsModal.classList.remove('show');
                }
            });
            
            btnPrintAllCards.addEventListener('click', () => {
                window.print();
            });
            
            btnShareAllCards.addEventListener('click', handleShareAllAsImage);

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: ÙØªØ­ Ø§Ù„Ù…Ø¹Ø±Ø¶ ÙˆØªØ­Ø¯ÙŠØ¯ Ø¨Ø·Ø§Ù‚Ø© Ø·Ø§Ù„Ø¨
            const params = new URLSearchParams(window.location.search);
            const view = params.get('view');
            const studentParam = params.get('student');
            if (view === 'all') {
                // Ø§ÙØªØ­ Ø§Ù„Ù…Ø¹Ø±Ø¶ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ø´Ø¨ÙƒØ©
                const openAndMaybeFocus = () => {
                    populateAllCardsModal();
                    if (studentParam) {
                        const studentName = decodeURIComponent(studentParam);
                        const grid = document.getElementById('miniCardsGrid');
                        const card = Array.from(grid.querySelectorAll('.mini-card')).find(el => (el.getAttribute('data-student-name')||'') === studentName);
                        if (card) {
                            card.classList.add('highlight');
                            card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            setTimeout(() => card.classList.remove('highlight'), 2500);
                        }
                    }
                };
                if (!allStudentsData.length) fetchAndDisplay().then(openAndMaybeFocus); else openAndMaybeFocus();
            }
        });

    </script>
</body>
</html>
